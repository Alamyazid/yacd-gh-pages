var x=Object.defineProperty,C=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var v=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))j.call(t,n)&&v(e,n,t[n]);if(h)for(var n of h(t))A.call(t,n)&&v(e,n,t[n]);return e},b=(e,t)=>C(e,E(t));import{r as F,t as H,v as f}from"./index.fbe6be2b.js";var w;(function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"})(w||(w={}));const D="/logs",J=new TextDecoder("utf-8"),N=()=>Math.floor((1+Math.random())*65536).toString(16);let L=!1,i=!1,a="",s,d;function m(e,t){let n;try{n=JSON.parse(e)}catch{console.log("JSON.parse error",JSON.parse(e))}const r=new Date,l=T(r);n.time=l,n.id=+r-0+N(),n.even=L=!L,t(n)}function T(e){const t=e.getFullYear()%100,n=f(e.getMonth()+1,2),r=f(e.getDate(),2),l=f(e.getHours(),2),o=f(e.getMinutes(),2),c=f(e.getSeconds(),2);return`${t}-${n}-${r} ${l}:${o}:${c}`}function M(e,t){return e.read().then(({done:n,value:r})=>{a+=J.decode(r,{stream:!n});const o=a.split(`
`),c=o[o.length-1];for(let g=0;g<o.length-1;g++)m(o[g],t);if(n){m(c,t),a="",console.log("GET /logs streaming done"),i=!1;return}else a=c;return M(e,t)})}function O(e){const t=Object.keys(e);return t.sort(),t.map(n=>e[n]).join("|")}let $,u;function Y(e,t){if(e.logLevel==="uninit"||i||s&&s.readyState===1)return;d=t;const n=F(e,D);s=new WebSocket(n),s.addEventListener("error",()=>{G(e,t)}),s.addEventListener("message",function(r){m(r.data,t)})}function q(){s.close(),u&&u.abort()}function z(e){!d||!s||(s.close(),i=!1,Y(e,d))}function G(e,t){if(u&&O(e)!==$)u.abort();else if(i)return;i=!0,$=O(e),u=new AbortController;const n=u.signal,{url:r,init:l}=H(e);fetch(r+D+"?level="+e.logLevel,b(p({},l),{signal:n})).then(o=>{const c=o.body.getReader();M(c,t)},o=>{i=!1,!n.aborted&&console.log("GET /logs error:",o.message)})}export{Y as f,z as r,q as s};
